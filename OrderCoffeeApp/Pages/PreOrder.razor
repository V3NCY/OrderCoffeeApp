@page "/PreOrder"
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<h1>Pre-Order Page</h1>

@if (!string.IsNullOrWhiteSpace(selectedCoffeeChoice))
{
        <div class="container text-center mt-5">
            <div class="row justify-content-center">
                <div class="col col-sm-4 col-md-3">
    <div style="color:#FAFAD2;">
        <h2 style="color:#FAFAD2;">Your Selected Coffee:</h2>
                    <p style="color:#FAFAD2;">@selectedCoffeeChoice</p>
            <div class="text-center">
               <img src="@GetImagePath(selectedCoffeeChoice)" alt="Selected Coffee" width="200" />
            </div>
                </div>
            </div>
        </div>
    </div>

        <form>
        <div class="container text-center mt-5">
            <div class="row justify-content-center">
                <div class="col col-sm-4 col-md-3">
        <h3 style="color:#FAFAD2; font-weight: bolder; font-size: 30px;">Options:</h3>
        <label for="quantity" style="color:#FAFAD2;">Choose coffee quantity:</label>
            <select id="quantity" @bind="coffeeQuantity">
                @for (int i = 1; i <= 10; i++)
                {
                    <option value="@i">@i</option>
                }
            </select>

        <div style="color:#FAFAD2;">
                <label>
                    <input type="checkbox" @bind="addSugar" /> Add sugar
                </label>
            </div>

        <div style="color:#FAFAD2;">
                <label>
                    <input type="checkbox" @bind="noSugar" /> No sugar
                </label>
            </div>

        <div style="color:#FAFAD2;">
                <label>
                    <input type="checkbox" @bind="longCoffee" /> Long coffee
                </label>
            </div>

        <div style="color:#FAFAD2;">
                <label>
                    <input type="checkbox" @bind="shortCoffee" /> Short coffee
                </label>
            </div>

            <div style="color:#FAFAD2;">
                <label>
                    <input type="checkbox" @bind="withMilk" /> With milk
                </label>
            </div>

        <div style="color:#FAFAD2;">
                <label>
                    <input type="checkbox" @bind="withoutMilk" /> Without milk
                </label>
            </div>
    </div>
    </div>
    </div>
        </form>
<div  style="display: flex;">
            <button class="btn default outlined-button justify-items-center my-3" style="color:#FAFAD2;" @onclick="Order">Order</button>
            </div>
<div  style="display: flex;">
        <button class="btn default outlined-button justify-items-center my-3" style="color:#FAFAD2;" @onclick="Cancel">Cancel</button>
</div>
}

else if (!string.IsNullOrWhiteSpace(GetMessageFromQueryString()))
{
    <p style="color:#FAFAD2;">@GetMessageFromQueryString()</p>
    <button class="btn default outlined-button justify-items-center my-3" style="color:#FAFAD2;" @onclick="GoBack">Go Back</button>
}

@code {
    public string Choice { get; set; }

    private string selectedCoffeeChoice;
    
    private int coffeeQuantity = 1;
    private bool addSugar;
    private bool noSugar;
    private bool longCoffee;
    private bool shortCoffee;
    private bool withMilk;
    private bool withoutMilk; 
    private string selectedBoxDescription;
    private bool mainBoxOpen = false;
    private string coffeeChoice;

    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        selectedCoffeeChoice = System.Web.HttpUtility.ParseQueryString(uri.Query).Get("choice");
    }

    private string GetImagePath(string coffeeChoice)
    {
        if (coffeeChoice == "Cappuccino") return "css/cappuccino.png";
        if (coffeeChoice == "Espresso") return "css/espresso.png";
        if (coffeeChoice == "Light Latte") return "css/lightlatte.png";
        if (coffeeChoice == "Can Panna") return "css/canpanna.png";

        return "css/default-coffee.png";
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo("/");
    }


    private async Task Order()
    {
        if (!string.IsNullOrWhiteSpace(selectedCoffeeChoice))
        {
            var confirmed = await JSRuntime.InvokeAsync<bool>("confirm", "Do you confirm your order?");
            if (confirmed)
            {
                NavigationManager.NavigateTo("/Payment"); // Redirect to the payment page
            }
        }
        else
        {
            // Handle the case where no coffee is selected (you can show a message or take appropriate action)
        }
    }

 private string GetMessageFromQueryString()
    {
        var uri = new Uri(NavigationManager.Uri);
        var message = System.Web.HttpUtility.ParseQueryString(uri.Query).Get("message");
        return message;
    }

    private void GoBack()
    {
        NavigationManager.NavigateTo("/");
    }
}
